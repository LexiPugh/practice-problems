# **Practice Problem #200: Make it Cleaner!**
### June 17th, 2024
### Languages Used: SQL

<br>

*This is the [Make it Cleaner!](https://www.analystbuilder.com/questions/make-it-cleaner-Ghbqf) practice problem from Analyst Builder. The question difficulty is Hard.*

<br>

**Table of Contents**

-   [The Question](#the-question)
-   [My Solution](#my-solution)
  
<br>

## The Question

This data is terrible. Just awful. But luckily we have the honor of cleaning it up!

That's where you come in.

I need you to ensure all Product_ID values are valid integers greater than 0. If it isn't just make it NULL. I'd appreciate it.

Replace negative values in Quantity_Sold with 0. Those negatives should NOT be there... Woops.

Replace NULL values in Revenue with the average revenue of all transactions. For Aggregation purposes of course. We aren't trying to lie to our shareholders!

The output should include the Product_ID, Quantity_Sold, Revenue

<br>

dirty_data Table:

| Field          | Data Type |
| :------------- | :-------- |
| transaction_id | int       |
| product_id     | int       |
| quantity_sold  | int       |
| revenue        | float     |

dirty_data Input:

| transaction_id | product_id | quantity_sold | revenue |
| :------------- | :--------- | :------------ | :------ |
| 1              | \-9        | 30            | 604.36  |
| 2              | 5          | 3             | 637.99  |
| 3              | 6          | 54            | 272.87  |
| 4              | \-4        | 41            | _NULL_  |
| 5              | 11         | 63            | 238.61  |
| 6              | 12         | \-4           | 440.03  |
| 7              | 15         | 46            | 200.76  |
| 8              | 9          | 11            | 560.15  |
| 9              | 19         | 49            | 674.63  |
| 10             | \-6        | 20            | 209.99  |
| 11             | 10         | 35            | 409.78  |
| 12             | \-4        | 58            | 163.31  |
| 13             | \-6        | 47            | 573.19  |
| 14             | 12         | 95            | _NULL_  |
| 15             | \-1        | 9             | 653.92  |
| 16             | 17         | 72            | 832.48  |
| 17             | \-2        | 21            | 312.01  |
| 18             | \-5        | 60            | 656.36  |
| 19             | \-6        | 50            | 372.55  |
| 20             | 5          | 65            | 179.89  |
| 21             | 7          | 23            | 374.74  |
| 22             | \-4        | 7             | 164.22  |
| 23             | 13         | 91            | 962.72  |
| 24             | 2          | 95            | 754.45  |
| 25             | 10         | 68            | 191.31  |
| 26             | \-7        | 86            | 807.64  |
| 27             | \-7        | \-10          | 416.94  |
| 28             | \-6        | 72            | 920.29  |
| 29             | 16         | 31            | 545.95  |
| 30             | 17         | 57            | 885.42  |
| 31             | \-2        | 75            | 298.48  |
| 32             | 8          | 52            | 430.47  |
| 33             | 14         | 90            | 430.15  |
| 34             | 2          | 24            | 187.42  |
| 35             | \-6        | 14            | 397.91  |
| 36             | 17         | 87            | _NULL_  |
| 37             | 14         | 62            | 519.89  |
| 38             | 3          | 2             | 891.31  |
| 39             | 14         | 40            | 342.7   |
| 40             | 1          | 53            | 419.34  |
| 41             | \-6        | 54            | 388.32  |
| 42             | 9          | 23            | _NULL_  |
| 43             | 14         | 49            | 269.4   |
| 44             | \-9        | 25            | 255.92  |
| 45             | 6          | 9             | _NULL_  |
| 46             | \-2        | \-4           | 438.98  |
| 47             | 12         | 13            | 628.39  |
| 48             | 11         | 86            | 149.64  |
| 49             | 13         | 50            | 226.77  |
| 50             | 0          | 8             | 186.72  |
| 51             | 19         | 86            | 830.9   |
| 52             | 11         | 52            | 192.83  |
| 53             | 8          | \-1           | 564.68  |
| 54             | \-4        | 13            | 240.02  |
| 55             | 13         | 30            | 350.94  |
| 56             | 0          | 66            | 894.34  |
| 57             | \-6        | 87            | 668.43  |
| 58             | 12         | \-4           | _NULL_  |
| 59             | 19         | 69            | 639.74  |
| 60             | \-2        | 24            | _NULL_  |
| 61             | 16         | 70            | 474.08  |
| 62             | \-7        | 89            | 120.2   |
| 63             | 7          | \-4           | 382.59  |
| 64             | 14         | 22            | 533.46  |
| 65             | 8          | 2             | 617.91  |
| 66             | 11         | 60            | 314.79  |
| 67             | 18         | 85            | 602.46  |
| 68             | 3          | 41            | 455.43  |
| 69             | \-10       | 35            | 555.92  |
| 70             | 16         | 7             | _NULL_  |
| 71             | 12         | 77            | 241.08  |
| 72             | 16         | 76            | 779.07  |
| 73             | 8          | 74            | 396.98  |
| 74             | \-1        | \-4           | 679.78  |
| 75             | 19         | 93            | 608.91  |
| 76             | 0          | 47            | 909.58  |
| 77             | 16         | 47            | 892.62  |
| 78             | \-3        | 73            | 498.8   |
| 79             | 0          | 62            | 284.26  |
| 80             | 15         | \-4           | 668.97  |
| 81             | \-1        | 77            | 673.15  |
| 82             | 5          | 8             | 723.18  |
| 83             | \-1        | 20            | 916.73  |
| 84             | 11         | 99            | 804.32  |
| 85             | 1          | \-4           | 662.76  |
| 86             | 3          | 77            | 640.87  |
| 87             | 18         | 3             | 291.48  |
| 88             | 16         | 89            | 686.23  |
| 89             | 16         | 43            | 833.05  |
| 90             | \-7        | 51            | 930.09  |
| 91             | \-4        | 30            | 924.99  |
| 92             | 10         | 28            | 604.99  |
| 93             | \-7        | 6             | _NULL_  |
| 94             | 3          | 37            | 400.42  |
| 95             | \-9        | 28            | 997.99  |
| 96             | 17         | 87            | _NULL_  |
| 97             | 9          | \-10          | 834.32  |
| 98             | \-6        | 95            | 637.31  |
| 99             | \-9        | 55            | 556.24  |
| 100            | 9          | 91            | 413.69  |

<br>

# My Solution

``` SQL
SELECT 
  CASE WHEN product_id > 0 THEN product_id ELSE NULL END AS product_id,
  CASE WHEN quantity_sold > 0 THEN quantity_sold ELSE 0 END AS quantity_sold,
  CASE WHEN revenue IS NOT NULL THEN revenue ELSE (SELECT AVG(revenue) FROM dirty_data) END AS revenue
FROM 
  dirty_data
```

Output Table:

| product_id | quantity_sold | revenue           |
| :--------- | :------------ | :---------------- |
| _NULL_     | 30            | 604.36            |
| 5          | 3             | 637.99            |
| 6          | 54            | 272.87            |
| _NULL_     | 41            | 526.7661111111113 |
| 11         | 63            | 238.61            |
| 12         | 0             | 440.03            |
| 15         | 46            | 200.76            |
| 9          | 11            | 560.15            |
| 19         | 49            | 674.63            |
| _NULL_     | 20            | 209.99            |
| 10         | 35            | 409.78            |
| _NULL_     | 58            | 163.31            |
| _NULL_     | 47            | 573.19            |
| 12         | 95            | 526.7661111111113 |
| _NULL_     | 9             | 653.92            |
| 17         | 72            | 832.48            |
| _NULL_     | 21            | 312.01            |
| _NULL_     | 60            | 656.36            |
| _NULL_     | 50            | 372.55            |
| 5          | 65            | 179.89            |
| 7          | 23            | 374.74            |
| _NULL_     | 7             | 164.22            |
| 13         | 91            | 962.72            |
| 2          | 95            | 754.45            |
| 10         | 68            | 191.31            |
| _NULL_     | 86            | 807.64            |
| _NULL_     | 0             | 416.94            |
| _NULL_     | 72            | 920.29            |
| 16         | 31            | 545.95            |
| 17         | 57            | 885.42            |
| _NULL_     | 75            | 298.48            |
| 8          | 52            | 430.47            |
| 14         | 90            | 430.15            |
| 2          | 24            | 187.42            |
| _NULL_     | 14            | 397.91            |
| 17         | 87            | 526.7661111111113 |
| 14         | 62            | 519.89            |
| 3          | 2             | 891.31            |
| 14         | 40            | 342.7             |
| 1          | 53            | 419.34            |
| _NULL_     | 54            | 388.32            |
| 9          | 23            | 526.7661111111113 |
| 14         | 49            | 269.4             |
| _NULL_     | 25            | 255.92            |
| 6          | 9             | 526.7661111111113 |
| _NULL_     | 0             | 438.98            |
| 12         | 13            | 628.39            |
| 11         | 86            | 149.64            |
| 13         | 50            | 226.77            |
| _NULL_     | 8             | 186.72            |
| 19         | 86            | 830.9             |
| 11         | 52            | 192.83            |
| 8          | 0             | 564.68            |
| _NULL_     | 13            | 240.02            |
| 13         | 30            | 350.94            |
| _NULL_     | 66            | 894.34            |
| _NULL_     | 87            | 668.43            |
| 12         | 0             | 526.7661111111113 |
| 19         | 69            | 639.74            |
| _NULL_     | 24            | 526.7661111111113 |
| 16         | 70            | 474.08            |
| _NULL_     | 89            | 120.2             |
| 7          | 0             | 382.59            |
| 14         | 22            | 533.46            |
| 8          | 2             | 617.91            |
| 11         | 60            | 314.79            |
| 18         | 85            | 602.46            |
| 3          | 41            | 455.43            |
| _NULL_     | 35            | 555.92            |
| 16         | 7             | 526.7661111111113 |
| 12         | 77            | 241.08            |
| 16         | 76            | 779.07            |
| 8          | 74            | 396.98            |
| _NULL_     | 0             | 679.78            |
| 19         | 93            | 608.91            |
| _NULL_     | 47            | 909.58            |
| 16         | 47            | 892.62            |
| _NULL_     | 73            | 498.8             |
| _NULL_     | 62            | 284.26            |
| 15         | 0             | 668.97            |
| _NULL_     | 77            | 673.15            |
| 5          | 8             | 723.18            |
| _NULL_     | 20            | 916.73            |
| 11         | 99            | 804.32            |
| 1          | 0             | 662.76            |
| 3          | 77            | 640.87            |
| 18         | 3             | 291.48            |
| 16         | 89            | 686.23            |
| 16         | 43            | 833.05            |
| _NULL_     | 51            | 930.09            |
| _NULL_     | 30            | 924.99            |
| 10         | 28            | 604.99            |
| _NULL_     | 6             | 526.7661111111113 |
| 3          | 37            | 400.42            |
| _NULL_     | 28            | 997.99            |
| 17         | 87            | 526.7661111111113 |
| 9          | 0             | 834.32            |
| _NULL_     | 95            | 637.31            |
| _NULL_     | 55            | 556.24            |
| 9          | 91            | 413.69            |
